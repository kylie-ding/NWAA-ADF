{
	"name": "SterlingLottery_to_DonorfyStaging",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "SterlingLotteryCSVBlobStorageMembers",
						"type": "DatasetReference"
					},
					"name": "SterlingLotteryInBlobStorage"
				},
				{
					"dataset": {
						"referenceName": "SterlingLotteryCSVBlobStorageWinners",
						"type": "DatasetReference"
					},
					"name": "SterlingLotteryWinnersInBlobStorage"
				},
				{
					"dataset": {
						"referenceName": "SterlingLotteryCSVBlobStoragePayments",
						"type": "DatasetReference"
					},
					"name": "SterlingLotteryPaymentsInBlobStorage"
				},
				{
					"dataset": {
						"referenceName": "SterlingLotteryCSVBlobStorageGAD",
						"type": "DatasetReference"
					},
					"name": "SterlingLotteryGADsInBlobStorage"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "AzureSQLImportConstituents",
						"type": "DatasetReference"
					},
					"name": "DonorfyConstituentImportStagingTable"
				},
				{
					"dataset": {
						"referenceName": "AzureSQLImportPurposes",
						"type": "DatasetReference"
					},
					"name": "DonorfyPurposesImportStagingTable"
				},
				{
					"dataset": {
						"referenceName": "AzureSQLImportTags",
						"type": "DatasetReference"
					},
					"name": "DonorfyTagsImportStagingTable"
				},
				{
					"dataset": {
						"referenceName": "AzureSQLImportActivities",
						"type": "DatasetReference"
					},
					"name": "DonorfyActivitiesImportStagingTable"
				},
				{
					"dataset": {
						"referenceName": "AzureSQLImportTransactions",
						"type": "DatasetReference"
					},
					"name": "DonorfyTransactionsImportStagingTable"
				},
				{
					"dataset": {
						"referenceName": "AzureSQLImportTags",
						"type": "DatasetReference"
					},
					"name": "DonorfyWinnerTagsImportStagingTable"
				},
				{
					"dataset": {
						"referenceName": "AzureSQLImportTags",
						"type": "DatasetReference"
					},
					"name": "DonorfySelfExcludeTagsImportStagingTable"
				},
				{
					"dataset": {
						"referenceName": "AzureSQLImportTransactionsAdditionalAllocations",
						"type": "DatasetReference"
					},
					"name": "DonorfyTransactionAdditionalAllocationssImportStagingTable"
				},
				{
					"dataset": {
						"referenceName": "AzureSQLImportGADs",
						"type": "DatasetReference"
					},
					"name": "DonorfyGADStagingTable"
				}
			],
			"transformations": [
				{
					"name": "derivedConstituentColumns"
				},
				{
					"name": "purposeDerivedColumns"
				},
				{
					"name": "uknownPurposeDerivedColumn"
				},
				{
					"name": "derivedIntegrationColumns"
				},
				{
					"name": "tagDerivedColumn"
				},
				{
					"name": "joinWinnersToIntegrationColumns"
				},
				{
					"name": "derivedWinnerActivityColumn"
				},
				{
					"name": "derivedDateColumn"
				},
				{
					"name": "derivedCampaign"
				},
				{
					"name": "joinPaymentsToIntegrationColumns"
				},
				{
					"name": "derivedTransactionColumns"
				},
				{
					"name": "derivedWinnerTagColumns"
				},
				{
					"name": "filterSelfExclusion"
				},
				{
					"name": "tagSelfExcludeDerivedColumn"
				},
				{
					"name": "RowNumber"
				},
				{
					"name": "derivedColumnConstant"
				},
				{
					"name": "filterDonationAmount"
				},
				{
					"name": "derivedTransactionLotteryColumns"
				},
				{
					"name": "derivedTransactionDonationColumns"
				},
				{
					"name": "joinGADsToIntegrationColumns"
				},
				{
					"name": "derivedGADColumns"
				}
			],
			"scriptLines": [
				"parameters{",
				"     DonorfyTenantCode as string ('ZRTXSIYSU7'),",
				"     IntegrationName as string ('NWAASterlingLottery'),",
				"     ADFPipelineName as string (''),",
				"     ADFPipelineRunId as string (''),",
				"     DonorfyKeyPrefix as string ('SL'),",
				"     DonorfyLotteryPurpose as string ('Lottery Comms'),",
				"     DonorfyLotteryCampaign as string ('Lift Off Lotto'),",
				"     DonorfyLotteryTagCategory as string ('Lottery'),",
				"     DonorfyLotteryActiveTag as string ('Lottery Member'),",
				"     DonorfyLotteryCancelledTag as string ('Cancelled Lottery Member'),",
				"     DonorfyDeceasedReason as string ('Deceased'),",
				"     DonorfyGoneAwayReason as string ('Gone away'),",
				"     DonorfyBankAccount as string ('Co-Op - Main Account'),",
				"     DonorfyLotteryProduct as string ('Lottery Payment'),",
				"     DonorfyFund as string ('Unrestricted'),",
				"     DonorfyDefaultPaymentMethod as string ('Unknown'),",
				"     RunDate as date (currentDate()),",
				"     DonorfyDepartment as string ('Lottery'),",
				"     DonorfyLotteryWinnerTag as string ('Lottery Winner'),",
				"     DonorfyLotterySelfExcludeTag as string ('Lottery Self Exclusion'),",
				"     DonorfyDonationProduct as string ('Donation'),",
				"     DonorfyGADMethod as string ('Written')",
				"}",
				"source(output(",
				"          {Player ID} as string,",
				"          {Client Member ID} as string,",
				"          Title as string,",
				"          FirstName as string,",
				"          Surname as string,",
				"          {Address 1} as string,",
				"          {Address 2} as string,",
				"          {Address 3} as string,",
				"          {Address 4} as string,",
				"          {Town / City} as string,",
				"          County as string,",
				"          Postcode as string,",
				"          Phone as string,",
				"          {E-mail} as string,",
				"          Mobile as string,",
				"          {Date of Birth} as string,",
				"          {Created Date} as string,",
				"          {Member Status} as string,",
				"          {Cancelled Date} as string,",
				"          {Cancelled Reason} as string,",
				"          {Number of Numbers} as string,",
				"          {Active Numbers} as string,",
				"          {Inactive Numbers} as string,",
				"          {Earliest Draw} as string,",
				"          {Current Balance} as string,",
				"          {Total Payments} as string,",
				"          {Total Payments Amount} as string,",
				"          {Total Winnings} as string,",
				"          {Draws Dormant} as string,",
				"          SourceCode as string,",
				"          {Payment Frequency} as string,",
				"          {Payment Method} as string,",
				"          {Cash Round Reference} as string,",
				"          {Payroll Round Reference} as string,",
				"          {Bank Account} as string,",
				"          {Modulus Check} as string,",
				"          {Payment Status} as string,",
				"          Canvasser as string,",
				"          {Supported Charity} as string,",
				"          {Lottery Mail} as string,",
				"          Publicity as string,",
				"          {Un-contactable (Gone Away)} as string,",
				"          {No Cancellation Mail} as string,",
				"          {Donor Number} as string,",
				"          {Last Modified} as string,",
				"          {Receipt Code} as string,",
				"          Deceased as string,",
				"          {Raffle Marketing - All} as string,",
				"          {Organisation Imposed - Email} as string,",
				"          {Direct Communication - Email} as string,",
				"          {Charity Marketing - Email} as string,",
				"          {FPS Registered - Email} as string,",
				"          {TPS Registered - Home Telephone} as string,",
				"          {Organisation Imposed - Home Telephone} as string,",
				"          {Direct Communication - Home Telephone} as string,",
				"          {FPS Registered - Home Telephone} as string,",
				"          {Charity Marketing - Home Telephone} as string,",
				"          {MPS Registered - Letter} as string,",
				"          {FPS Registered - Letter} as string,",
				"          {Direct Communication - Letter} as string,",
				"          {Organisation Imposed - Letter} as string,",
				"          {Charity Marketing - Letter} as string,",
				"          {FPS Registered - Mobile} as string,",
				"          {TPS Registered - Mobile} as string,",
				"          {Direct Communication - Mobile} as string,",
				"          {Charity Marketing - Mobile} as string,",
				"          {Organisation Imposed - Mobile} as string,",
				"          {FPS Registered - SMS} as string,",
				"          {Charity Marketing - SMS} as string,",
				"          {Direct Communication - SMS} as string,",
				"          {Organisation Imposed - SMS} as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false,",
				"     moveFiles: ['Input Files','Processed Files'],",
				"     rowUrlColumn: 'FileName',",
				"     wildcardPaths:['Input Files/All Member Export*.csv']) ~> SterlingLotteryInBlobStorage",
				"source(output(",
				"          MembershipID as string,",
				"          LotteryNum as string,",
				"          FullName as string,",
				"          Address1 as string,",
				"          Address2 as string,",
				"          Address3 as string,",
				"          Town as string,",
				"          Postcode as string,",
				"          {Phone Number} as string,",
				"          Mobile as string,",
				"          Email as string,",
				"          {Alternative Email} as string,",
				"          {Payment Method} as string,",
				"          PrizeValue as string,",
				"          {Cheque No} as string,",
				"          Publicity as string,",
				"          {Supported Charity} as string,",
				"          {Rollover Prize} as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false,",
				"     moveFiles: ['Input Files','Processed Files'],",
				"     rowUrlColumn: 'FileName',",
				"     wildcardPaths:['Input Files/Winning Numbers*.csv']) ~> SterlingLotteryWinnersInBlobStorage",
				"source(output(",
				"          {Membership ID} as string,",
				"          {Lottery Number} as string,",
				"          {Payment Method} as string,",
				"          {Lottery Payment Amount} as string,",
				"          {Total Payment Amount} as string,",
				"          {Payment Date} as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false,",
				"     moveFiles: ['Input Files','Processed Files'],",
				"     wildcardPaths:['Input Files/NWAA - Payment Export*.csv']) ~> SterlingLotteryPaymentsInBlobStorage",
				"source(output(",
				"          membershipID as string,",
				"          clientMemberID as string,",
				"          title as string,",
				"          firstname as string,",
				"          surname as string,",
				"          address1 as string,",
				"          address2 as string,",
				"          address3 as string,",
				"          town as string,",
				"          county as string,",
				"          country as string,",
				"          postcode as string,",
				"          giftAidDate as string,",
				"          hasDonationAccount as string,",
				"          donationAccountType as string,",
				"          donationSource as string,",
				"          donationTotal as string,",
				"          donationBalance as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     ignoreNoFilesFound: false,",
				"     moveFiles: ['Input Files','Processed Files'],",
				"     wildcardPaths:['Input Files/Members with giftaid*.csv']) ~> SterlingLotteryGADsInBlobStorage",
				"derivedCampaign derive(IsActive = case({Un-contactable (Gone Away)}==\"Member is un-contactable\" || Deceased==\"Yes\",0),",
				"          ArchiveReason = case(Deceased==\"Yes\",$DonorfyDeceasedReason,{Un-contactable (Gone Away)}==\"Member is un-contactable\",$DonorfyGoneAwayReason,\"\"),",
				"          DateOfBirthDateType = toDate({Date of Birth}, \"dd/mm/yyyy\"),",
				"          OkToEmail = case({Charity Marketing - Email}==\"Opt Out\", 0, {Charity Marketing - Email}==\"Opt In\",1),",
				"          OkToMail = case({Charity Marketing - Letter}==\"Opt Out\", 0, {Charity Marketing - Letter}==\"Opt In\",1),",
				"          OKToPhone = case({Charity Marketing - Home Telephone} ==\"Opt Out\", 0, {Charity Marketing - Home Telephone}==\"Opt In\",1),",
				"          OKToSMS = case({Charity Marketing - SMS} ==\"Opt Out\", 0, {Charity Marketing - SMS}==\"Opt In\",1),",
				"          ConstituentType = \"Individual\",",
				"          DateAdded = $RunDate) ~> derivedConstituentColumns",
				"derivedIntegrationColumns derive(Purpose = $DonorfyLotteryPurpose,",
				"          OptIn = case(iifNull({Cancelled Reason},\"\") != \"Self Exclude\" && {Lottery Mail} == \"Allowed\", 1,0),",
				"          OptOut = case(iifNull({Cancelled Reason},\"\")  == \"Self Exclude\" || {Lottery Mail} != \"Allowed\", 1,0),",
				"          ContactChannelDetails = case(\r",
				"!(isNull({E-mail}) || trim({E-mail}) == '') && {Charity Marketing - Email} == 'Opt In' ,'Email',\r",
				"!(isNull(Postcode) || trim(Postcode) == '') && {Charity Marketing - Letter} != 'Opt Out' ,'Mail',\r",
				"!(isNull(Phone) || trim(Phone) == '') && {Charity Marketing - Home Telephone}  == 'Opt In' ,'Phone',\r",
				"!(isNull(Mobile) ||trim(Mobile) == '') && {Charity Marketing - Mobile} == 'Opt In' ,'Phone','')) ~> purposeDerivedColumns",
				"purposeDerivedColumns derive(Unknown = case(OptIn == 0 && OptOut ==0, 1,0),",
				"          ContactChannelDetails = case(!(isNull({E-mail}) || trim({E-mail}) == '') && {Charity Marketing - Email} == 'Opt In' ,'Email',!(isNull(Postcode) || trim(Postcode) == '') && {Charity Marketing - Letter} != 'Opt Out' ,'Mail',!(isNull(Phone) || trim(Phone) == '') && {Charity Marketing - Home Telephone} == 'Opt In' ,'Phone',!(isNull(Mobile) ||trim(Mobile) == '') && {Charity Marketing - Mobile} == 'Opt In' ,'Phone','')) ~> uknownPurposeDerivedColumn",
				"SterlingLotteryInBlobStorage derive(TenantCode = $DonorfyTenantCode,",
				"          IntegrationName = $IntegrationName,",
				"          ADFPipelineName = $ADFPipelineName,",
				"          ADFPipelineRunId = $ADFPipelineRunId,",
				"          IntegrationSourceConstituentKey = concat($DonorfyKeyPrefix,{Player ID}),",
				"          ProcessedRecord = 0) ~> derivedIntegrationColumns",
				"derivedIntegrationColumns derive(TagCategory = $DonorfyLotteryTagCategory,",
				"          TagName = case(equals({Member Status},'Active'), $DonorfyLotteryActiveTag, $DonorfyLotteryCancelledTag),",
				"          Code1 = {Cancelled Reason},",
				"          Code2 = {Active Numbers},",
				"          Code3 = {Inactive Numbers},",
				"          Code4 = Canvasser,",
				"          DateTagged = currentDate(),",
				"          TagStartDate = toDate({Created Date},'dd/MM/yyyy'),",
				"          TagEndDate = toDate({Cancelled Date},'dd/MM/yyyy'),",
				"          Date1 = iif(isDate({Earliest Draw}, 'dd/MM/yyyy'), toDate({Earliest Draw},'dd/MM/yyyy'), toDate(null(),'dd/MM/yyyy')),",
				"          Number1 = toInteger({Number of Numbers}),",
				"          Operation = \"INSERT\",",
				"          IsActive = 1) ~> tagDerivedColumn",
				"SterlingLotteryWinnersInBlobStorage, derivedCampaign join(MembershipID == {Player ID},",
				"     joinType:'inner',",
				"     matchType:'exact',",
				"     ignoreSpaces: false,",
				"     broadcast: 'auto')~> joinWinnersToIntegrationColumns",
				"joinWinnersToIntegrationColumns derive(ActivityDate = case(isDate(substring(SterlingLotteryWinnersInBlobStorage@FileName, instr(SterlingLotteryWinnersInBlobStorage@FileName,'Winning%20Numbers%20')+length('Winning%20Numbers%20'), 10),'dd-MM-yy'),toDate(substring(SterlingLotteryWinnersInBlobStorage@FileName, instr(SterlingLotteryWinnersInBlobStorage@FileName,'Winning%20Numbers%20')+length('Winning%20Numbers%20'), 10),'dd-MM-yy'),currentDate()),",
				"          Code1 = PrizeValue,",
				"          Code2 = SterlingLotteryInBlobStorage@Publicity,",
				"          Code3 = {Rollover Prize},",
				"          ActivityType = \"Lottery Win\") ~> derivedWinnerActivityColumn",
				"derivedIntegrationColumns derive(CreatedDateDateType = toDate({Created Date},\"dd/mm/yyyy\")) ~> derivedDateColumn",
				"derivedDateColumn derive(Campaign = case(year(CreatedDateDateType)<=2017,\"Lottery Income - Historic\",\r",
				"SourceCode==\"LOTENG\",\"Lottery Income - Tower Sign Up\",\r",
				"SourceCode==\"LOTGEN\" ||SourceCode==\"Unknown\",\"Lottery Income - Tower Sign Up\",\r",
				"SourceCode==\"WEB\",\"Lottery Income - Web Sign Up\",\r",
				"SourceCode==\"LOTRAP\",\"Lottery Income - Web Sign Up\",\r",
				"SourceCode==\"LOTPAP\",\"Lottery Income - Paper Sign Up\",\r",
				"SourceCode==\"Unity4 Acquisition\",\"Lottery Income - UN4 Sign Up\",\r",
				"\"Lottery Income - Tower Sign Up\")) ~> derivedCampaign",
				"RowNumber, derivedCampaign join({Membership ID} == {Player ID},",
				"     joinType:'inner',",
				"     matchType:'exact',",
				"     ignoreSpaces: false,",
				"     broadcast: 'auto')~> joinPaymentsToIntegrationColumns",
				"joinPaymentsToIntegrationColumns derive(PaymentMethod = case (SterlingLotteryPaymentsInBlobStorage@{Payment Method}==\"Cash\",\"Cash\",\r",
				"SterlingLotteryPaymentsInBlobStorage@{Payment Method}==\"Cheque\",\"Cheque\",\r",
				"SterlingLotteryPaymentsInBlobStorage@{Payment Method}==\"Direct Debit\",\"Direct Debit via Sterling\",\r",
				"SterlingLotteryPaymentsInBlobStorage@{Payment Method}==\"Standing Order\",\"Standing Order via Sterling\",\r",
				"$DonorfyDefaultPaymentMethod),",
				"          BankAccount = $DonorfyBankAccount,",
				"          Fund = $DonorfyFund,",
				"          DateOfTransaction = case(isDate({Payment Date},'dd/MM/yyyy'),toDate({Payment Date},'dd/MM/yyyy'),currentDate()),",
				"          Department = $DonorfyDepartment) ~> derivedTransactionColumns",
				"derivedWinnerActivityColumn derive(TagCategory = $DonorfyLotteryTagCategory,",
				"          TagName = $DonorfyLotteryWinnerTag,",
				"          DateTagged = $RunDate,",
				"          TagStartDate = ActivityDate,",
				"          Operation = \"INSERT\",",
				"          IsActive = 1) ~> derivedWinnerTagColumns",
				"derivedIntegrationColumns filter({Cancelled Reason}==\"Self Exclude\") ~> filterSelfExclusion",
				"filterSelfExclusion derive(TagCategory = $DonorfyLotteryTagCategory,",
				"          TagName = $DonorfyLotterySelfExcludeTag,",
				"          DateTagged = currentDate(),",
				"          TagStartDate = toDate({Cancelled Date},'dd/MM/yyyy'),",
				"          IsActive = 1,",
				"          Operation = \"INSERT\") ~> tagSelfExcludeDerivedColumn",
				"derivedColumnConstant window(asc(ConstantOne, true),",
				"     RowNumber = rowNumber()) ~> RowNumber",
				"SterlingLotteryPaymentsInBlobStorage derive(ConstantOne = 1) ~> derivedColumnConstant",
				"derivedTransactionColumns filter(toDecimal({Total Payment Amount}) > toDecimal({Lottery Payment Amount})) ~> filterDonationAmount",
				"derivedTransactionColumns derive(Product = $DonorfyLotteryProduct,",
				"          Amount = {Lottery Payment Amount}) ~> derivedTransactionLotteryColumns",
				"filterDonationAmount derive(AllocationProduct = $DonorfyDonationProduct,",
				"          AllocationAmount = toDecimal({Total Payment Amount}) - toDecimal({Lottery Payment Amount})) ~> derivedTransactionDonationColumns",
				"SterlingLotteryGADsInBlobStorage, derivedCampaign join(membershipID == {Player ID},",
				"     joinType:'inner',",
				"     matchType:'exact',",
				"     ignoreSpaces: false,",
				"     broadcast: 'auto')~> joinGADsToIntegrationColumns",
				"joinGADsToIntegrationColumns derive(DeclarationDate = case(isDate(giftAidDate,'yyyy-MM-dd'),toDate(giftAidDate,'yyyy-MM-dd'),currentDate()),",
				"          GADCampaign = Campaign,",
				"          DeclarationEndDate = addMonths(case(isDate(giftAidDate,'yyyy-MM-dd'),toDate(giftAidDate,'yyyy-MM-dd'),currentDate()),100 * 12),",
				"          ConfirmationRequired = 0,",
				"          Operation = \"INSERT\",",
				"          DeclarationMethod = $DonorfyGADMethod) ~> derivedGADColumns",
				"derivedConstituentColumns sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     input(",
				"          ConstituentsImportId as integer,",
				"          TenantCode as string,",
				"          IntegrationName as string,",
				"          ADFPipelineName as string,",
				"          ADFPipelineRunId as string,",
				"          IntegrationSourceConstituentKey as string,",
				"          ProcessedRecord as boolean,",
				"          IsActive as boolean,",
				"          ArchiveReason as string,",
				"          ArchiveDate as date,",
				"          ExternalKey as string,",
				"          Title as string,",
				"          FirstName as string,",
				"          LastName as string,",
				"          Suffix as string,",
				"          Formerly as string,",
				"          HouseBuildingNumber as string,",
				"          Address1 as string,",
				"          Address2 as string,",
				"          Town as string,",
				"          County as string,",
				"          Postcode as string,",
				"          Country as string,",
				"          Area as string,",
				"          PhoneNumber as string,",
				"          OtherPhoneNumber as string,",
				"          MobilePhoneNumber as string,",
				"          NationalIDNumber as string,",
				"          EmailAddress1 as string,",
				"          EmailAddress2 as string,",
				"          LabelName as string,",
				"          Salutation as string,",
				"          Work_HouseBuildingNumber as string,",
				"          Work_Address1 as string,",
				"          Work_Address2 as string,",
				"          Work_Town as string,",
				"          Work_County as string,",
				"          Work_Postcode as string,",
				"          Work_Country as string,",
				"          Work_Area as string,",
				"          Work_PhoneNumber as string,",
				"          Work_OtherPhoneNumber as string,",
				"          Work_MobilePhoneNumber as string,",
				"          Work_EmailAddress1 as string,",
				"          Work_EmailAddress2 as string,",
				"          Work_LabelName as string,",
				"          Work_Salutation as string,",
				"          WebSite as string,",
				"          RecruitmentCampaign as string,",
				"          DateOfBirth as date,",
				"          YearOfBirth as integer,",
				"          OrganisationName as string,",
				"          JobTitle as string,",
				"          Department as string,",
				"          Gender as string,",
				"          ConstituentType as string,",
				"          Comments as string,",
				"          OKToMail as boolean,",
				"          OKToPhone as boolean,",
				"          OKToSMS as boolean,",
				"          OKToEmail as boolean,",
				"          AllowNameSwap as boolean,",
				"          HasGAD as boolean,",
				"          GiftAidNumber as integer,",
				"          GADDecDate as date,",
				"          DeclarationMethod as string,",
				"          GADStartDate as date,",
				"          GADEndDate as date,",
				"          GADCancelled as boolean,",
				"          GADCancelDate as date,",
				"          TaxPayerTitle as string,",
				"          TaxPayerFirstName as string,",
				"          TaxPayerLastName as string,",
				"          RefusedGAD as boolean,",
				"          IncludeRow as boolean,",
				"          IsGroupConstituent as boolean,",
				"          FK_TenantId as string,",
				"          ConstituentId as string,",
				"          GiftAidDecId as string,",
				"          TagId as string,",
				"          IsGroup as boolean,",
				"          PersonalContactDetailsId as string,",
				"          WorkContactDetailsId as string,",
				"          OtherContactDetailsId as string,",
				"          FK_ConstituentTypeId as string,",
				"          FK_RecruitmentCampaign as string,",
				"          FK_CountryId as string,",
				"          FK_ArchiveReasonId as string,",
				"          FK_DeclarationMethod as string,",
				"          FK_WorkCountryId as string,",
				"          MainContactConstituentId as string,",
				"          MainContactPersonalContactDetailsId as string,",
				"          MainContactWorkContactDetailsId as string,",
				"          MainContactOtherContactDetailsId as string,",
				"          MainContactFK_ConstituentTypeId as string,",
				"          ConstituentNumber as long,",
				"          FK_Area_Id as string,",
				"          FK_Work_Area_Id as string,",
				"          MatchScore as integer,",
				"          HowIntegrated as string,",
				"          FileName as string,",
				"          DateAdded as timestamp,",
				"          ErrorMessage as string,",
				"          OriginalConstituentsImportId as integer,",
				"          RetryAttempts as integer,",
				"          OrderNumber as integer,",
				"          SuccessfullyReprocessed as boolean,",
				"          MatchAttempted as boolean,",
				"          OrderId as long,",
				"          Operation as string",
				"     ),",
				"     deletable:false,",
				"     insertable:true,",
				"     updateable:false,",
				"     upsertable:false,",
				"     format: 'table',",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true,",
				"     errorHandlingOption: 'stopOnFirstError',",
				"     mapColumn(",
				"          TenantCode,",
				"          IntegrationName,",
				"          ADFPipelineName,",
				"          ADFPipelineRunId,",
				"          IntegrationSourceConstituentKey,",
				"          ProcessedRecord,",
				"          Title,",
				"          FirstName,",
				"          LastName = Surname,",
				"          HouseBuildingNumber = {Address 1},",
				"          Address1 = {Address 2},",
				"          Address2 = {Address 3},",
				"          Town = {Town / City},",
				"          County,",
				"          Postcode,",
				"          EmailAddress1 = {E-mail},",
				"          MobilePhoneNumber = Mobile,",
				"          IsActive,",
				"          ArchiveReason,",
				"          OKToEmail = OkToEmail,",
				"          OKToMail = OkToMail,",
				"          OKToPhone,",
				"          OKToSMS,",
				"          RecruitmentCampaign = Campaign,",
				"          DateOfBirth = DateOfBirthDateType,",
				"          ConstituentType,",
				"          FileName,",
				"          DateAdded",
				"     )) ~> DonorfyConstituentImportStagingTable",
				"uknownPurposeDerivedColumn sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     input(",
				"          PurposesImportId as integer,",
				"          TenantCode as string,",
				"          IntegrationName as string,",
				"          ADFPipelineName as string,",
				"          ADFPipelineRunId as string,",
				"          IntegrationSourceConstituentKey as string,",
				"          ProcessedRecord as boolean,",
				"          ExternalKey as string,",
				"          Purpose as string,",
				"          OptIn as boolean,",
				"          OptOut as boolean,",
				"          Unknown as boolean,",
				"          DateReceived as timestamp,",
				"          CommsPrefId as string,",
				"          FK_TenantId as string,",
				"          FK_ConstituentId as string,",
				"          FK_PreferenceType as string,",
				"          ContactChannelDetails as string,",
				"          Confirmed as boolean,",
				"          Allowed as boolean",
				"     ),",
				"     deletable:false,",
				"     insertable:true,",
				"     updateable:false,",
				"     upsertable:false,",
				"     format: 'table',",
				"     errorHandlingOption: 'stopOnFirstError',",
				"     mapColumn(",
				"          TenantCode,",
				"          IntegrationName,",
				"          ADFPipelineName,",
				"          ADFPipelineRunId,",
				"          IntegrationSourceConstituentKey,",
				"          Purpose,",
				"          OptIn,",
				"          OptOut,",
				"          Unknown,",
				"          ProcessedRecord,",
				"          ContactChannelDetails",
				"     )) ~> DonorfyPurposesImportStagingTable",
				"tagDerivedColumn sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     input(",
				"          TagsImportId as integer,",
				"          TenantCode as string,",
				"          IntegrationName as string,",
				"          ADFPipelineName as string,",
				"          ADFPipelineRunId as string,",
				"          IntegrationSourceConstituentKey as string,",
				"          ProcessedRecord as boolean,",
				"          ExternalKey as string,",
				"          DateTagged as date,",
				"          TagIsActive as boolean,",
				"          TagCategory as string,",
				"          TagName as string,",
				"          TagStartDate as date,",
				"          TagEndDate as date,",
				"          Comments as string,",
				"          Code1 as string,",
				"          Code2 as string,",
				"          Code3 as string,",
				"          Code4 as string,",
				"          Code5 as string,",
				"          Code6 as string,",
				"          Code7 as string,",
				"          Code8 as string,",
				"          Code9 as string,",
				"          Code10 as string,",
				"          Date1 as date,",
				"          Date2 as date,",
				"          Date3 as date,",
				"          Date4 as date,",
				"          Date5 as date,",
				"          Date6 as date,",
				"          Date7 as date,",
				"          Date8 as date,",
				"          Date9 as date,",
				"          Date10 as date,",
				"          Number1 as decimal(9,2),",
				"          Number2 as decimal(9,2),",
				"          Number3 as decimal(9,2),",
				"          Number4 as decimal(9,2),",
				"          Number5 as decimal(9,2),",
				"          Number6 as decimal(9,2),",
				"          Number7 as decimal(9,2),",
				"          Number8 as decimal(9,2),",
				"          Number9 as decimal(9,2),",
				"          Number10 as decimal(9,2),",
				"          YesNo1 as boolean,",
				"          YesNo2 as boolean,",
				"          YesNo3 as boolean,",
				"          YesNo4 as boolean,",
				"          YesNo5 as boolean,",
				"          YesNo6 as boolean,",
				"          YesNo7 as boolean,",
				"          YesNo8 as boolean,",
				"          YesNo9 as boolean,",
				"          YesNo10 as boolean,",
				"          ConstituentId as string,",
				"          FK_TagCategoryLookUpTypeRefId as string,",
				"          FK_TagLookUpRefId as string,",
				"          FK_TenantId as string,",
				"          ErrorMessage as string,",
				"          Operation as string,",
				"          SourceSystemInfo as string",
				"     ),",
				"     deletable:false,",
				"     insertable:true,",
				"     updateable:false,",
				"     upsertable:false,",
				"     format: 'table',",
				"     errorHandlingOption: 'stopOnFirstError',",
				"     mapColumn(",
				"          TenantCode,",
				"          IntegrationName,",
				"          ADFPipelineName,",
				"          ADFPipelineRunId,",
				"          IntegrationSourceConstituentKey,",
				"          ProcessedRecord,",
				"          TagCategory,",
				"          TagName,",
				"          DateTagged,",
				"          TagStartDate,",
				"          TagEndDate,",
				"          Code1,",
				"          Code2,",
				"          Code3,",
				"          Code4,",
				"          Date1,",
				"          Number1,",
				"          Operation,",
				"          TagIsActive = IsActive",
				"     )) ~> DonorfyTagsImportStagingTable",
				"derivedWinnerActivityColumn sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     input(",
				"          ActivitiesImportId as integer,",
				"          TenantCode as string,",
				"          IntegrationName as string,",
				"          ADFPipelineName as string,",
				"          ADFPipelineRunId as string,",
				"          IntegrationSourceConstituentKey as string,",
				"          ProcessedRecord as boolean,",
				"          ExternalKey as string,",
				"          LinkedConstituentExternalKey as string,",
				"          ActivityNumber as integer,",
				"          Campaign as string,",
				"          DateOfActivity as date,",
				"          ActivityType as string,",
				"          Comments as string,",
				"          ShowAlert as boolean,",
				"          SegmentCode as string,",
				"          SegmentName as string,",
				"          ConstituentId as string,",
				"          ActivityId as string,",
				"          FK_Campaign as string,",
				"          FK_ActivityType as string,",
				"          FK_TenantId as string,",
				"          Code1 as string,",
				"          Code2 as string,",
				"          Code3 as string,",
				"          Code4 as string,",
				"          Code5 as string,",
				"          Code6 as string,",
				"          Code7 as string,",
				"          Code8 as string,",
				"          Code9 as string,",
				"          Code10 as string,",
				"          Date1 as date,",
				"          Date2 as date,",
				"          Date3 as date,",
				"          Date4 as date,",
				"          Date5 as date,",
				"          Date6 as date,",
				"          Date7 as date,",
				"          Date8 as date,",
				"          Date9 as date,",
				"          Date10 as date,",
				"          Number1 as decimal(9,2),",
				"          Number2 as decimal(9,2),",
				"          Number3 as decimal(9,2),",
				"          Number4 as decimal(9,2),",
				"          Number5 as decimal(9,2),",
				"          Number6 as decimal(9,2),",
				"          Number7 as decimal(9,2),",
				"          Number8 as decimal(9,2),",
				"          Number9 as decimal(9,2),",
				"          Number10 as decimal(9,2),",
				"          YesNo1 as boolean,",
				"          YesNo2 as boolean,",
				"          YesNo3 as boolean,",
				"          YesNo4 as boolean,",
				"          YesNo5 as boolean,",
				"          YesNo6 as boolean,",
				"          YesNo7 as boolean,",
				"          YesNo8 as boolean,",
				"          YesNo9 as boolean,",
				"          YesNo10 as boolean,",
				"          LinkUrl as string,",
				"          FileName as string,",
				"          ErrorMessage as string",
				"     ),",
				"     deletable:false,",
				"     insertable:true,",
				"     updateable:false,",
				"     upsertable:false,",
				"     format: 'table',",
				"     errorHandlingOption: 'stopOnFirstError',",
				"     mapColumn(",
				"          TenantCode,",
				"          IntegrationName,",
				"          ADFPipelineName,",
				"          ADFPipelineRunId,",
				"          IntegrationSourceConstituentKey,",
				"          ProcessedRecord,",
				"          Campaign,",
				"          ActivityType,",
				"          DateOfActivity = ActivityDate,",
				"          Code1,",
				"          Code2,",
				"          Code3,",
				"          FileName = SterlingLotteryWinnersInBlobStorage@FileName",
				"     )) ~> DonorfyActivitiesImportStagingTable",
				"derivedTransactionLotteryColumns sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     input(",
				"          TransactionsImportId as integer,",
				"          TenantCode as string,",
				"          IntegrationName as string,",
				"          ADFPipelineName as string,",
				"          ADFPipelineRunId as string,",
				"          IntegrationSourceConstituentKey as string,",
				"          ProcessedRecord as boolean,",
				"          TransactionNumber1 as integer,",
				"          TransactionNumber2 as integer,",
				"          ExternalKey as string,",
				"          GiftAidFlag as string,",
				"          Campaign as string,",
				"          DateOfTransaction as date,",
				"          Amount as decimal(19,4),",
				"          Product as string,",
				"          PaymentMethod as string,",
				"          BankAccount as string,",
				"          Fund as string,",
				"          Currency as string,",
				"          Reference as string,",
				"          Comments as string,",
				"          SegmentCode as string,",
				"          Channel as string,",
				"          ConnectedConstituentExternalKey as string,",
				"          BeneficiaryConstituentExternalKey as string,",
				"          ConstituentId as string,",
				"          TransactionId1 as string,",
				"          TransactionId2 as string,",
				"          FK_PaymentMethod as string,",
				"          FK_BankAccount as string,",
				"          FK_Product as string,",
				"          FK_Fund as string,",
				"          FK_Currency as string,",
				"          FK_Campaign as string,",
				"          FK_TenantId as string,",
				"          FK_ChannelId as string,",
				"          ConnectedConstituentConstituentId as string,",
				"          BeneficiaryConstituentConstituentId as string,",
				"          Quantity as decimal(9,2),",
				"          FileName as string,",
				"          ProcessingCostsAmount as decimal(19,4),",
				"          ErrorMessage as string,",
				"          Department as string,",
				"          PayoutReference as string,",
				"          IntegrationSourceTransactionKey as string,",
				"          CanRecoverTax as boolean",
				"     ),",
				"     deletable:false,",
				"     insertable:true,",
				"     updateable:false,",
				"     upsertable:false,",
				"     format: 'table',",
				"     errorHandlingOption: 'stopOnFirstError',",
				"     mapColumn(",
				"          TenantCode,",
				"          IntegrationName,",
				"          ADFPipelineName,",
				"          ADFPipelineRunId,",
				"          IntegrationSourceConstituentKey,",
				"          ProcessedRecord,",
				"          Amount,",
				"          Product,",
				"          PaymentMethod,",
				"          Fund,",
				"          Campaign,",
				"          BankAccount,",
				"          Department,",
				"          FileName,",
				"          DateOfTransaction,",
				"          IntegrationSourceTransactionKey = RowNumber",
				"     )) ~> DonorfyTransactionsImportStagingTable",
				"derivedWinnerTagColumns sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     input(",
				"          TagsImportId as integer,",
				"          TenantCode as string,",
				"          IntegrationName as string,",
				"          ADFPipelineName as string,",
				"          ADFPipelineRunId as string,",
				"          IntegrationSourceConstituentKey as string,",
				"          ProcessedRecord as boolean,",
				"          ExternalKey as string,",
				"          DateTagged as date,",
				"          TagIsActive as boolean,",
				"          TagCategory as string,",
				"          TagName as string,",
				"          TagStartDate as date,",
				"          TagEndDate as date,",
				"          Comments as string,",
				"          Code1 as string,",
				"          Code2 as string,",
				"          Code3 as string,",
				"          Code4 as string,",
				"          Code5 as string,",
				"          Code6 as string,",
				"          Code7 as string,",
				"          Code8 as string,",
				"          Code9 as string,",
				"          Code10 as string,",
				"          Date1 as date,",
				"          Date2 as date,",
				"          Date3 as date,",
				"          Date4 as date,",
				"          Date5 as date,",
				"          Date6 as date,",
				"          Date7 as date,",
				"          Date8 as date,",
				"          Date9 as date,",
				"          Date10 as date,",
				"          Number1 as decimal(9,2),",
				"          Number2 as decimal(9,2),",
				"          Number3 as decimal(9,2),",
				"          Number4 as decimal(9,2),",
				"          Number5 as decimal(9,2),",
				"          Number6 as decimal(9,2),",
				"          Number7 as decimal(9,2),",
				"          Number8 as decimal(9,2),",
				"          Number9 as decimal(9,2),",
				"          Number10 as decimal(9,2),",
				"          YesNo1 as boolean,",
				"          YesNo2 as boolean,",
				"          YesNo3 as boolean,",
				"          YesNo4 as boolean,",
				"          YesNo5 as boolean,",
				"          YesNo6 as boolean,",
				"          YesNo7 as boolean,",
				"          YesNo8 as boolean,",
				"          YesNo9 as boolean,",
				"          YesNo10 as boolean,",
				"          ConstituentId as string,",
				"          FK_TagCategoryLookUpTypeRefId as string,",
				"          FK_TagLookUpRefId as string,",
				"          FK_TenantId as string,",
				"          ErrorMessage as string,",
				"          Operation as string,",
				"          SourceSystemInfo as string",
				"     ),",
				"     deletable:false,",
				"     insertable:true,",
				"     updateable:false,",
				"     upsertable:false,",
				"     format: 'table',",
				"     errorHandlingOption: 'stopOnFirstError',",
				"     mapColumn(",
				"          TenantCode,",
				"          IntegrationName,",
				"          ADFPipelineName,",
				"          ADFPipelineRunId,",
				"          IntegrationSourceConstituentKey,",
				"          TagCategory,",
				"          TagName,",
				"          DateTagged,",
				"          TagStartDate,",
				"          Operation,",
				"          TagIsActive = IsActive,",
				"          ProcessedRecord",
				"     )) ~> DonorfyWinnerTagsImportStagingTable",
				"tagSelfExcludeDerivedColumn sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     input(",
				"          TagsImportId as integer,",
				"          TenantCode as string,",
				"          IntegrationName as string,",
				"          ADFPipelineName as string,",
				"          ADFPipelineRunId as string,",
				"          IntegrationSourceConstituentKey as string,",
				"          ProcessedRecord as boolean,",
				"          ExternalKey as string,",
				"          DateTagged as date,",
				"          TagIsActive as boolean,",
				"          TagCategory as string,",
				"          TagName as string,",
				"          TagStartDate as date,",
				"          TagEndDate as date,",
				"          Comments as string,",
				"          Code1 as string,",
				"          Code2 as string,",
				"          Code3 as string,",
				"          Code4 as string,",
				"          Code5 as string,",
				"          Code6 as string,",
				"          Code7 as string,",
				"          Code8 as string,",
				"          Code9 as string,",
				"          Code10 as string,",
				"          Date1 as date,",
				"          Date2 as date,",
				"          Date3 as date,",
				"          Date4 as date,",
				"          Date5 as date,",
				"          Date6 as date,",
				"          Date7 as date,",
				"          Date8 as date,",
				"          Date9 as date,",
				"          Date10 as date,",
				"          Number1 as decimal(9,2),",
				"          Number2 as decimal(9,2),",
				"          Number3 as decimal(9,2),",
				"          Number4 as decimal(9,2),",
				"          Number5 as decimal(9,2),",
				"          Number6 as decimal(9,2),",
				"          Number7 as decimal(9,2),",
				"          Number8 as decimal(9,2),",
				"          Number9 as decimal(9,2),",
				"          Number10 as decimal(9,2),",
				"          YesNo1 as boolean,",
				"          YesNo2 as boolean,",
				"          YesNo3 as boolean,",
				"          YesNo4 as boolean,",
				"          YesNo5 as boolean,",
				"          YesNo6 as boolean,",
				"          YesNo7 as boolean,",
				"          YesNo8 as boolean,",
				"          YesNo9 as boolean,",
				"          YesNo10 as boolean,",
				"          ConstituentId as string,",
				"          FK_TagCategoryLookUpTypeRefId as string,",
				"          FK_TagLookUpRefId as string,",
				"          FK_TenantId as string,",
				"          ErrorMessage as string,",
				"          Operation as string,",
				"          SourceSystemInfo as string",
				"     ),",
				"     deletable:false,",
				"     insertable:true,",
				"     updateable:false,",
				"     upsertable:false,",
				"     format: 'table',",
				"     errorHandlingOption: 'stopOnFirstError',",
				"     mapColumn(",
				"          TenantCode,",
				"          IntegrationName,",
				"          ADFPipelineName,",
				"          ADFPipelineRunId,",
				"          IntegrationSourceConstituentKey,",
				"          ProcessedRecord,",
				"          TagCategory,",
				"          TagName,",
				"          DateTagged,",
				"          TagStartDate,",
				"          TagIsActive = IsActive,",
				"          Operation",
				"     )) ~> DonorfySelfExcludeTagsImportStagingTable",
				"derivedTransactionDonationColumns sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     input(",
				"          TransactionAllocationsImportId as integer,",
				"          TenantCode as string,",
				"          IntegrationName as string,",
				"          ADFPipelineName as string,",
				"          ADFPipelineRunId as string,",
				"          IntegrationSourceConstituentKey as string,",
				"          ProcessedRecord as boolean,",
				"          FK_TransactionsImportId as integer,",
				"          Amount as decimal(19,4),",
				"          Product as string,",
				"          Quantity as decimal(9,2),",
				"          Fund as string,",
				"          Department as string,",
				"          AllocationDate as date,",
				"          GiftAidFlag as string,",
				"          Comments as string,",
				"          BeneficiaryConstituentExternalKey as string,",
				"          BeneficiaryConstituentConstituentId as string,",
				"          ExternalKey as string,",
				"          FK_Product as string,",
				"          FK_Fund as string,",
				"          FK_DepartmentId as string,",
				"          FK_Currency as string,",
				"          FK_TenantId as string,",
				"          IntegrationSourceTransactionKey as string,",
				"          CanRecoverTax as boolean",
				"     ),",
				"     deletable:false,",
				"     insertable:true,",
				"     updateable:false,",
				"     upsertable:false,",
				"     format: 'table',",
				"     errorHandlingOption: 'stopOnFirstError',",
				"     mapColumn(",
				"          TenantCode,",
				"          IntegrationName,",
				"          ADFPipelineName,",
				"          ADFPipelineRunId,",
				"          IntegrationSourceConstituentKey,",
				"          ProcessedRecord,",
				"          Amount = AllocationAmount,",
				"          Product = AllocationProduct,",
				"          Fund,",
				"          Department,",
				"          AllocationDate = DateOfTransaction,",
				"          IntegrationSourceTransactionKey = RowNumber",
				"     )) ~> DonorfyTransactionAdditionalAllocationssImportStagingTable",
				"derivedGADColumns sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     input(",
				"          GADImportId as integer,",
				"          TenantCode as string,",
				"          IntegrationName as string,",
				"          ADFPipelineName as string,",
				"          ADFPipelineRunId as string,",
				"          IntegrationSourceConstituentKey as string,",
				"          ProcessedRecord as boolean,",
				"          DeclarationMethod as string,",
				"          ConstituentId as string,",
				"          Campaign as string,",
				"          DeclarationDate as date,",
				"          DeclarationStartDate as date,",
				"          DeclarationEndDate as date,",
				"          GADCancelled as boolean,",
				"          GADCancelDate as date,",
				"          GADDeclarationId as string,",
				"          TaxPayerTitle as string,",
				"          TaxPayerFirstName as string,",
				"          TaxPayerLastName as string,",
				"          ConfirmationRequired as boolean,",
				"          ErrorMessage as string,",
				"          Operation as string,",
				"          SourceSystemInfo as string,",
				"          ConfirmedDate as date",
				"     ),",
				"     deletable:false,",
				"     insertable:true,",
				"     updateable:false,",
				"     upsertable:false,",
				"     format: 'table',",
				"     skipDuplicateMapOutputs: true,",
				"     errorHandlingOption: 'stopOnFirstError',",
				"     mapColumn(",
				"          TenantCode,",
				"          IntegrationName,",
				"          ADFPipelineName,",
				"          ADFPipelineRunId,",
				"          IntegrationSourceConstituentKey,",
				"          ProcessedRecord,",
				"          DeclarationMethod,",
				"          Campaign = GADCampaign,",
				"          DeclarationDate,",
				"          TaxPayerTitle = SterlingLotteryGADsInBlobStorage@title,",
				"          TaxPayerFirstName = SterlingLotteryGADsInBlobStorage@firstname,",
				"          TaxPayerLastName = SterlingLotteryGADsInBlobStorage@surname,",
				"          ConfirmationRequired,",
				"          Operation,",
				"          DeclarationStartDate = DeclarationDate,",
				"          DeclarationEndDate",
				"     )) ~> DonorfyGADStagingTable"
			]
		}
	}
}